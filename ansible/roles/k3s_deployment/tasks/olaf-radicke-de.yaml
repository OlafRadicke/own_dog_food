---

- name: create deployment
  kubernetes.core.k8s:
    kubeconfig:                 "{{ k3s_kubeconfig }}"
    state:                      "{{ k3s_deployment_state }}"
    namespace:                  "{{ k3s_namespace }}"
    wait:                       "yes"
    definition:
      apiVersion:               apps/v1
      kind:                     Deployment
      metadata:
        namespace:              "{{ k3s_namespace }}"
        name:                   olaf-radicke-de
        labels:
          app:                  olaf-radicke-de
      spec:
        selector:
          matchLabels:
            app:                olaf-radicke-de
        template:
          metadata:
            labels:
              app:              olaf-radicke-de
          spec:
            containers:
            - name:             olaf-radicke-de
              image:            olafradicke/olaf-radicke-de:2.10
              imagePullPolicy:  IfNotPresent
              ports:
              - containerPort:  80
            imagePullSecrets:
            - name:             regcred

- name: create a service object
  kubernetes.core.k8s:
    kubeconfig:                 "{{ k3s_kubeconfig }}"
    state:                      "{{ k3s_deployment_state }}"
    namespace:                  "{{ k3s_namespace }}"
    wait:                       "yes"
    definition:
      apiVersion:               v1
      kind:                     Service
      metadata:
        name:                   olaf-radicke-de
        namespace:              "{{ k3s_namespace }}"
        labels:
          app:                  olaf-radicke-de
      spec:
        type:                   ClusterIP
        selector:
          app:                  olaf-radicke-de
        ports:
        - targetPort:           80
          port:                 80



